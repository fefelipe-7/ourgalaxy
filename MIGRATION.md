# Guia de Migração: Mock para Supabase

Este documento descreve a estrutura de dados e os passos necessários para realizar a migração completa para o backend Supabase.

---

## 1. Configuração do Supabase

Certifique-se de que o arquivo `lib/supabaseClient.ts` esteja configurado corretamente com as variáveis de ambiente ou constantes do seu projeto.

---

## 2. Tabelas do Banco de Dados

Execute os seguintes comandos SQL no **SQL Editor** do seu painel Supabase para criar as tabelas necessárias.

### Tabela: `absences` (Saudades)

Substitui os dados mockados em `pages/Absences.tsx`.

```sql
-- Criação da tabela de Saudades
create table public.absences (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  text text not null,
  author_id text not null,
  type text default 'miss'
);

-- Habilitar RLS (Recomendado)
alter table public.absences enable row level security;

-- Política de acesso (Simplificada para uso com strings 'nana'/'fefe')
create policy "Enable access to all users" on public.absences for all using (true);
```

### Tabela: `letters` (Cartas)

Substitui os dados mockados em `pages/Home.tsx`.

```sql
-- Criação da tabela de Cartas
create table public.letters (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  content text not null,
  preview text,
  author_id text not null,
  recipient_id text not null,
  likes int default 1
);

-- Habilitar RLS (Recomendado)
alter table public.letters enable row level security;

-- Política de acesso
create policy "Enable access to all users" on public.letters for all using (true);
```

### Tabela: `moments` (Momentos)

Estrutura necessária para `pages/Moments.tsx`.

```sql
create table public.moments (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  date_memory date not null,
  time_memory time,
  description text not null,
  media_url text not null,
  media_type text not null,
  author_id text not null
);

alter table public.moments enable row level security;
create policy "Enable access to all users" on public.moments for all using (true);
```

---

## 3. Storage (Buckets)

Siga estes passos para configurar o armazenamento de mídia para a galeria de momentos.

### Passo 1: Criar o Bucket
1. No painel do Supabase, vá para a seção **Storage**.
2. Clique em **New Bucket**.
3. Em "Name your bucket", digite: `moments-media`.
4. **Importante:** Ative a opção **"Public bucket"** (ON).
5. Clique em **Save**.

### Passo 2: Configurar Políticas (RLS)
Para permitir que o aplicativo faça upload e leia imagens, você precisa configurar as políticas de acesso.

1. Na aba **Storage**, clique em **Configuration** e depois em **Policies**.
2. Na seção do bucket `moments-media`, clique em **New Policy**.
3. Escolha **"For full customization"**.

**Política de Leitura (SELECT):**
*   **Policy Name:** `Public Access`
*   **Allowed Operation:** `SELECT`
*   **Target roles:** `anon` (ou deixe selecionado default)
*   **USING expression:** `true`
*   Clique em **Save**.

**Política de Upload (INSERT):**
*   Clique em **New Policy** novamente no bucket `moments-media`.
*   **Policy Name:** `Public Upload`
*   **Allowed Operation:** `INSERT`
*   **Target roles:** `anon` (ou deixe selecionado default)
*   **WITH CHECK expression:** `true`
*   Clique em **Save**.

---

## 4. Próximos Passos no Código

Após configurar o banco de dados e o storage, você deve descomentar as linhas de integração nos seguintes arquivos:

1.  `pages/Home.tsx`: Ativar `letterService.getLetters()`.
2.  `pages/Absences.tsx`: Ativar `absenceService.getAbsences()` e `createAbsence`.
3.  `pages/LetterWrite.tsx`: Ativar `letterService.sendLetter()`.

O arquivo `services/momentService.ts` já está configurado para usar o bucket `moments-media`.
